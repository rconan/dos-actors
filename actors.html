<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Actors - GMT DOS ACTORS</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded "><a href="gmt-actor-model.html"><strong aria-hidden="true">1.</strong> GMT Actors Model</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="actors.html" class="active"><strong aria-hidden="true">1.1.</strong> Actors</a></li><li class="chapter-item expanded "><a href="model.html"><strong aria-hidden="true">1.2.</strong> Model</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">GMT DOS ACTORS</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="actors"><a class="header" href="#actors">Actors</a></h1>
<p>An actor is composed on 3 elements:</p>
<ul>
<li>a set of inputs,</li>
<li>a set of outputs,</li>
<li>a client.</li>
</ul>
<p>Both outputs and inputs are optional but an actor must have at least either one input or one output.
Inputs and outputs may be sampled at a different rate, but the rate must be the same for all inputs and for all outputs.</p>
<p><img src="actor-model.svg" alt="Gmt actors" /></p>
<p>An actor runs within its own thread independently of other actors and perform 3 functions:</p>
<ol>
<li>collect and read inputs into the client,</li>
<li>update the state of the client,</li>
<li>write and distribute the outputs from the client to other actors.</li>
</ol>
<p>These 3 functions are excuted sequentially within a loop.</p>
<p>A client must comply with the definition of the actor interface.
The interface consists in 3 traits: <code>Update</code>, <code>Read</code> and <code>Write</code>.
A client must:</p>
<ul>
<li>implement the <code>Update</code> trait,</li>
<li>have an implementation of the <code>Read</code> trait for each input,</li>
<li>have an implementation of the <code>Write</code> trait for each output.</li>
</ul>
<p>Actor inputs and outputs are given a unique type, usually an empty Enum.
Each input and output must implement the <code>UniqueIdentifier</code> trait which associated type <code>DataType</code> is set to the primitive type of the client data.</p>
<p>As an example, lets write an interface for a client which task is to multiply an integer by e.
Lets define</p>
<ul>
<li>the client:</li>
</ul>
<pre><code class="language-rust no_run noplayground">#[derive(Default)]
struct Client {
   data: i32,
}</code></pre>
<ul>
<li>the input <code>In</code>:</li>
</ul>
<pre><code class="language-rust no_run noplayground">#[derive(UID)]
#[uid(data = &quot;i32&quot;)]
enum In {}</code></pre>
<ul>
<li>the output <code>Out</code>:</li>
</ul>
<pre><code class="language-rust no_run noplayground">#[derive(UID)]
#[uid(data = &quot;f32&quot;)]
enum Out {}</code></pre>
<p>Each input and output is given a unique type (here an empty <code>Enum</code>) that implements the <code>UniqueIdentifier</code> trait with the derive macro <code>UID</code>. 
The input/ouput primitive types (<code>i32</code> for the input and <code>f32</code> for the ouput) are affected to the associated type <code>DataType</code> of the <code>UniqueIdentifier</code> traits.</p>
<p>And now lets build the interface:</p>
<ul>
<li>update is empty, this simple task can be done at the output</li>
</ul>
<pre><code class="language-rust no_run noplayground">impl Update for Client {}</code></pre>
<ul>
<li>read input</li>
</ul>
<pre><code class="language-rust no_run noplayground">impl Read&lt;In&gt; for Client {
    fn read(&amp;mut self, data: Arc&lt;Data&lt;In&gt;&gt;) {
        self.data = **data;
    }
}
</code></pre>
<ul>
<li>write output</li>
</ul>
<pre><code class="language-rust no_run noplayground">impl Write&lt;Out&gt; for Client {
    fn write(&amp;mut self) -&gt; Option&lt;Arc&lt;Data&lt;Out&gt;&gt;&gt; {
        Some(Arc::new(Data::new(self.data as f32 * std::f32::consts::E)))
    }
}</code></pre>
<p>Actors exchange their clients data that is contained inside the structure <code>Data</code>. 
The type of the client data can be anything as long as the input that receives it or the output that sends it, implements the <code>UniqueIdentifier</code> trait.</p>
<p>Once the actor to client interface has been written, the client can then be used to build an actor.
Here is the signature of the <code>Actor</code> type:</p>
<pre><code class="language-rust no_run noplayground">struct Actor&lt;C, const NI: usize = 1, const NO: usize = 1&gt; where C: Update</code></pre>
<p>An actor takes 3 generic type parameters: </p>
<ul>
<li><code>C</code>: the type of the client,</li>
<li><code>NI</code>: the sampling rate of the inputs,</li>
<li><code>NO</code>: the sampling rate of the outputs.</li>
</ul>
<p>Sampling rates are given as ratio between the simulation sampling frequency and the actor inputs or outputs sampling frequency.
The where clause required that the client implements the <code>Update</code> trait, meaning that anything can be an actor's client as long as it implements the <code>Update</code> trait.</p>
<p>Actors implements the <a href="https://doc.rust-lang.org/std/convert/trait.From.html">From</a> trait for any type that implements the <code>Update</code> trait. 
As a consequence, a client can be converted into an actor with:</p>
<pre><code class="language-rust no_run noplayground">let actor = Actor::&lt;Client,1,1&gt;::from(client);</code></pre>
<p>When using the default value (1) for the inputs and outputs rate, they can be omitted:</p>
<pre><code class="language-rust no_run noplayground">let actor = Actor::&lt;Client&gt;::from(client);</code></pre>
<p>In that case, the compiler is also able to infer the client type:</p>
<pre><code class="language-rust no_run noplayground">let actor = Actor::&lt;_&gt;::from(client);</code></pre>
<p>or we can use the <a href="https://doc.rust-lang.org/std/convert/trait.Into.html">Into</a> syntax:</p>
<pre><code class="language-rust no_run noplayground">let actor: Actor::&lt;_&gt; = client.into();</code></pre>
<p>An actor with no inputs must set <code>NI</code> to 0 or use the type alias <code>Initiator</code> defined as <code>Initiator&lt;C, const NO: usize = 1&gt; = Actor&lt;C, 0, NO&gt;</code>:</p>
<pre><code class="language-rust no_run noplayground">let no_input_actor = Initiator::&lt;_&gt;::from(client);</code></pre>
<p>An actor with no outputs must set <code>NO</code> to 0 or use the type alias <code>Terminator</code> defined as <code>Terminator&lt;C, const NI: usize = 1&gt; = Actor&lt;C, NI, 0&gt;</code>:</p>
<pre><code class="language-rust no_run noplayground">let no_output_actor = Terminator::&lt;_&gt;::from(client);</code></pre>
<p>The conversion methods <code>from</code> and <code>into</code> consume their arguments meaning that the client is no longer available once the actor has been created.
This is not always desirable, instead the <code>new</code> method of  <code>Actor</code> can be used to pass a reference to the client into an actor.</p>
<p>It is worth noting that all the inputs and outputs of an actor will also be given a copy of the reference to the client in order to pass data to it and to get data from it.
And because an actor performs many of its own tasks asynchronously, a client must first be wrapped into the thread-safe smart pointers <a href="https://doc.rust-lang.org/std/sync/struct.Arc.html">Arc</a> and <a href="https://doc.rust-lang.org/std/sync/struct.Mutex.html">Mutex</a> like so</p>
<pre><code class="language-rust no_run noplayground">let thread_safe_client = Arc::new(Mutex::new(client));</code></pre>
<p>followed by the actor declaration</p>
<pre><code class="language-rust no_run noplayground">let actor = Actor::new(thread_safe_client);</code></pre>
<p>Note that all types that implements the <code>Update</code> trait can be converted into a thread safe type with</p>
<pre><code class="language-rust no_run noplayground">let thread_safe_client = client.into_arcx();</code></pre>
<p>A unique name can be given to an actor. 
The name will be use to identify the actor's client in the model flowchart.
The actor's name (here &quot;aleph&quot;) can be set either like this:</p>
<pre><code class="language-rust no_run noplayground">let actor = Actor::&lt;_&gt;::from((client, &quot;aleph&quot;));</code></pre>
<p>or like this</p>
<pre><code class="language-rust no_run noplayground">let actor: Actor::&lt;_&gt; = (client, &quot;aleph&quot;).into();</code></pre>
<p>or even like this</p>
<pre><code class="language-rust no_run noplayground">let actor = Actor::new(thread_safe_client).name(&quot;aleph&quot;);</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="gmt-actor-model.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="model.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="gmt-actor-model.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="model.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
